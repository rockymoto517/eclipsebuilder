const e=new Map([["en-us","English (American)"]]);let t="en-us";export default class a{constructor(e){this.dictionary,this.used,this.select=e}handleSelect(a,n){let s,o;const r=new URLSearchParams(window.location.search);for(const[t,a]of e){const e=new Option(a,t);this.select.appendChild(e)}const i=[...e.keys()];if(r.has("lang")&&e.has(r.get("lang"))){const e=r.get("lang");o=e,localStorage.setItem("lang",e)}else localStorage.getItem("lang")?o=localStorage.getItem("lang"):(e.has(navigator.language.toLowerCase())?t=navigator.language:i.some(e=>e.startsWith(navigator.language.split("-")[0]))?t=i.find(e=>e.startsWith(navigator.language.split("-")[0])):navigator.languages&&(t=navigator.languages.find(t=>e.has(t.toLowerCase()))||i.find(e=>navigator.languages.some(t=>e.startsWith(t.split("-")[0])))||t),t=t.toLowerCase(),o=t);return s=fetch(`./lang/${o}.json`).then(e=>e.json()),this.select.value=o,this.used=o,void 0!==n&&(a=a.bind(n)),this.select.addEventListener("change",async e=>{const t=e.target.value;localStorage.setItem("lang",t),this.used=t,this.loadDictionary(await fetch(`./lang/${t}.json`).then(e=>e.json())),a(t)}),fetch("./lang/en-us.json").then(e=>e.json())}loadDictionary(e){for(const t in e){const n=e[t];if("string"==typeof n){a.LOCATEREGEX.lastIndex=0;const[,...s]=a.LOCATEREGEX.exec(n)||[];if(0===s.length)continue;e[t]=e=>a.refFormat(a.replaceFormat(n,e.rep),e.ref)}else this.loadDictionary(n)}this.dictionary=e}get(e="",t=void 0){const a=e.split(".");let n=this.dictionary;for(const e of a)n=n[e],void 0===n&&console.error(`Could not find [${e}]`);return void 0===n?t:n}static replaceFormat(e,t){for(const a in t)e=e.replace(new RegExp(`%{${a}}`,"g"),t[a]);return e}static refFormat(e,t){a.REFREGEX.lastIndex=0;const[,...n]=a.REFREGEX.exec(e)||[];if(Array.isArray(t)&&n.length!==t.length)throw new Error("The array should have the same amount of functions as the lang text has variable as!");for(let a=0;a<n.length;a++)e=e.replace(new RegExp(`&{${n[a]}}`),t[a](n[a]));return e}}a.LOCATEREGEX=/(%|&){(.+)}/g,a.REFREGEX=/&{(.+)}/g,a.ref=new Map([["system.credits.p2",{ref:[e=>`<a href="https://github.com/r-paydaybuilds/pd2builder/blob/master/CONTRIBUTORS.md">${e}</a>`]}],["system.credits.license",{ref:[e=>`<a href="https://opensource.org/licenses/MIT">${e}</a>`]}]]);
